yearly_country_pulse = {
	on_actions = {
		quarterly_trade_pulse
		delay = { days = 91 }
		quarterly_trade_pulse
		delay = { days = 182 }
		quarterly_trade_pulse
		delay = { days = 273 }
		quarterly_trade_pulse
	}
}

quarterly_trade_pulse = {
	effect = {

		if = {
			limit = {
				NOT = { has_global_variable = done_quarterly_trade }
			}
			every_country = {
				every_governorships = {
					limit = {
						NOT = {
							has_variable = internal_trade_scope
						}
					}
					TRADE_set_internal_trade_scope = yes
					TRADE_update_governorship_TZs = yes # In case new governorships are formed. TODO: slot this into the territory ownership changed effect once that is made
				}
				every_governorships = {
					TRADE_governorship_get_pops_this_quarter = yes
					GOODS_governorship_produce_all = yes
					COTTAGEIND_produce_all = yes
				}
			}
			set_global_variable = {
				name = done_quarterly_trade
				days = 1
			}
		}

	}
	events = {
		# piechart_update.1 # Update shipping values
		debug_demand.1
		debug_demand.2
		# trade.2 # Defunct
		# debug_demand.3 # Produce manufactured goods
	}

	on_actions = {
		quarterly_global_trade_food
		delay = { days = 20 }
		quarterly_global_trade_luxury
		delay = { days = 40 }
		quarterly_global_trade_3
		delay = { days = 60 }
		quarterly_global_trade_4
		delay = { days = 61 }
		quarterly_apply_trade_changes_and_consume
	}
}

quarterly_apply_trade_changes_and_consume = {
	effect = {

		every_governorships = {
			# Actually apply the changes to stockpiles and get shortages
			CONSUME_all_stockpiles = yes
		}

	}
}

quarterly_global_trade_food = {
	effect = {

		if = {
			limit = {
				NOT = { has_global_variable = done_quarterly_global_trade_food }
			}
			GT_split_do_global_trade_split = { type = food }
			set_global_variable = {
				name = done_quarterly_global_trade_food
				days = 1
			}
		}

	}
}
quarterly_global_trade_luxury = {
	effect = {

		if = {
			limit = {
				NOT = { has_global_variable = done_quarterly_global_trade_luxury }
			}
			GT_split_do_global_trade_split = { type = luxury }
			set_global_variable = {
				name = done_quarterly_global_trade_luxury
				days = 1
			}
		}

	}
}
quarterly_global_trade_3 = {
	effect = {

		if = {
			limit = {
				NOT = { has_global_variable = done_quarterly_global_trade_3 }
			}
			GT_split_do_global_trade_split = { type = 3 }
			set_global_variable = {
				name = done_quarterly_global_trade_3
				days = 1
			}
		}

	}
}
quarterly_global_trade_4 = {
	effect = {

		if = {
			limit = {
				NOT = { has_global_variable = done_quarterly_global_trade_4 }
			}
			GT_split_do_global_trade_split = { type = 4 }
			set_global_variable = {
				name = done_quarterly_global_trade_4
				days = 1
			}
		}

	}
}